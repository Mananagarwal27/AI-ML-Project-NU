<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SVM Stock Predictor (RBF)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0b1020;
            --panel: #121836;
            --panel-2: #0f1530;
            --text: #e8ecff;
            --muted: #a8b0d8;
            --brand: #6c8cff;
            --ok: #3ad29f;
            --warn: #ffcc66;
            --bad: #ff6b6b;
            --border: #2a3260;
        }
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            font-family: 'Inter', system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(180deg, #0a0f1f, #0b1125 20%, #0b1020 100%);
            color: var(--text);
        }
        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px;
        }
        header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 18px;
        }
        .logo {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: radial-gradient(120% 140% at 0% 0%, #9bb1ff 0%, #6c8cff 45%, #3b58ff 90%);
            box-shadow: 0 8px 24px #22307a66;
        }
        h1 {
            font-size: clamp(20px, 3vw, 28px);
            margin: 0;
            font-weight: 700;
            letter-spacing: .2px;
        }
        .sub {
            color: var(--muted);
            font-size: 14px;
        }
        .grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 18px;
        }
        @media (max-width: 930px) {
            .grid { grid-template-columns: 1fr; }
        }
        .card {
            background: linear-gradient(180deg, var(--panel), var(--panel-2));
            border: 1px solid var(--border);
            border-radius: 18px;
            box-shadow: 0 10px 30px #0006;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }
        .card .hd {
            padding: 16px 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card .bd {
            padding: 16px 18px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        label {
            display: block;
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 6px;
        }
        input, select, button {
            width: 100%;
            padding: 12px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: #0d142e;
            color: var(--text);
            font-size: 14px;
            transition: border-color 0.2s;
        }
        input:focus, select:focus {
            border-color: var(--brand);
            outline: none;
        }
        input::placeholder { color: #7f86ad; }
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        @media (max-width: 600px) {
            .row { grid-template-columns: 1fr; }
        }
        .ck {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0 4px 0;
            font-size: 14px;
        }
        .ck input { width: auto; }
        button {
            background: linear-gradient(180deg, #7c95ff, #5b75ff);
            cursor: pointer;
            border: none;
            box-shadow: 0 8px 20px #3041b555;
            font-weight: 600;
            transition: background 0.2s, box-shadow 0.2s;
        }
        button:disabled {
            opacity: .6;
            cursor: not-allowed;
        }
        .meta {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        @media (max-width: 600px) {
            .meta { grid-template-columns: 1fr 1fr; }
        }
        .metric {
            background: #0d142e;
            border: 1px dashed var(--border);
            padding: 12px;
            border-radius: 14px;
            text-align: center;
        }
        .metric h4 {
            margin: 2px 0 4px 0;
            font-size: 12px;
            color: var(--muted);
            font-weight: 500;
        }
        .metric .v {
            font-size: 18px;
            font-weight: 700;
        }
        .good { color: var(--ok); }
        .mid { color: var(--warn); }
        .bad { color: var(--bad); }
        .muted { color: var(--muted); }
        .footer {
            margin-top: 14px;
            color: var(--muted);
            font-size: 12px;
            text-align: right;
        }
        .note {
            font-size: 12px;
            color: var(--muted);
            margin-top: 10px;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border);
            background: #0d142e;
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
        }
        .flex {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #7f89c4;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        canvas {
            width: 100% !important;
            height: 340px !important;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 12px #0002;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="logo" aria-hidden="true"></div>
            <div>
                <h1>SVM Stock Predictor (RBF)</h1>
                <div class="sub">Interactive frontend for your SVM model — select a ticker, date range, and features, then fetch predictions from your backend API.</div>
            </div>
        </header>
        <main class="grid">
            <section class="card" aria-labelledby="configTitle">
                <div class="hd">
                    <strong id="configTitle">Configuration</strong>
                    <span class="pill">Kernel: RBF • Model: SVC</span>
                </div>
                <div class="bd">
                    <form id="predictForm" autocomplete="off">
                        <div class="row">
                            <div>
                                <label for="ticker">Ticker</label>
                                <input id="ticker" name="ticker" placeholder="e.g., IBM, AAPL, MSFT" value="IBM" required />
                            </div>
                            <div>
                                <label for="index">Benchmark Index (optional)</label>
                                <input id="index" name="index" placeholder="e.g., ^GSPC for S&P 500" />
                            </div>
                        </div>
                        <div class="row">
                            <div>
                                <label for="start">Start date</label>
                                <input id="start" name="start" type="date" required />
                            </div>
                            <div>
                                <label for="end">End date</label>
                                <input id="end" name="end" type="date" required />
                            </div>
                        </div>
                        <fieldset style="margin-top:10px; border:none; padding:0;">
                            <legend style="font-size:13px; color:var(--muted); margin-bottom:6px;">Features</legend>
                            <div class="ck"><input id="feat-vol" type="checkbox" checked><span>Stock volatility</span></div>
                            <div class="ck"><input id="feat-mom" type="checkbox" checked><span>Stock momentum</span></div>
                            <div class="ck"><input id="feat-idxvol" type="checkbox"><span>Index volatility</span></div>
                            <div class="ck"><input id="feat-idxmom" type="checkbox"><span>Index momentum</span></div>
                            <div class="ck"><input id="feat-rsi" type="checkbox" checked><span>RSI (14)</span></div>
                        </fieldset>
                        <div style="margin-top:16px" class="row">
                            <button id="runBtn" type="submit">Get Prediction</button>
                            <button id="resetBtn" type="button" style="background:transparent;border:1px solid var(--border);box-shadow:none">Reset</button>
                        </div>
                    </form>
                    <div id="status" class="flex" style="margin-top:12px"></div>
                    <div class="note">This UI expects a POST <code>/api/predict</code> endpoint. If it isn't available, it will auto‑use a mock response so you can see the UI working.</div>
                </div>
            </section>
            <section class="card" aria-labelledby="resultsTitle">
                <div class="hd">
                    <strong id="resultsTitle">Results</strong>
                    <span class="muted" id="dateRange"></span>
                </div>
                <div class="bd">
                    <div class="meta">
                        <div class="metric"><h4>Accuracy</h4><div class="v" id="m-acc">—</div></div>
                        <div class="metric"><h4>Precision</h4><div class="v" id="m-prec">—</div></div>
                        <div class="metric"><h4>Recall</h4><div class="v" id="m-rec">—</div></div>
                        <div class="metric"><h4>F1</h4><div class="v" id="m-f1">—</div></div>
                    </div>
                    <div style="margin-top:18px">
                        <canvas id="priceChart" aria-label="Price Chart"></canvas>
                    </div>
                    <div style="margin-top:18px">
                        <canvas id="probaChart" aria-label="Probability Chart"></canvas>
                    </div>
                    <div class="footer">Economic use is illustrative only; not financial advice.</div>
                </div>
            </section>
        </main>
    </div>
    <script>
        // ---------- Utilities ----------
        const $ = (id) => document.getElementById(id);
        const fmt = (x, d=3) => (x==null || isNaN(x)) ? '—' : Number(x).toFixed(d);

        // Default dates: last 2 years
        function setDefaultDates() {
            const end = new Date();
            const start = new Date();
            start.setFullYear(end.getFullYear() - 2);
            $('start').value = start.toISOString().slice(0, 10);
            $('end').value = end.toISOString().slice(0, 10);
        }
        setDefaultDates();

        // Charts
        let priceChart, probaChart;
        function drawCharts(dates, close, yPred, yProba) {
            const ctx1 = $('priceChart').getContext('2d');
            const ctx2 = $('probaChart').getContext('2d');
            if (priceChart) priceChart.destroy();
            if (probaChart) probaChart.destroy();

            priceChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        { label: 'Close', data: close, tension: .25 },
                        { label: 'Predicted Up (marker)', data: close.map((v, i) => yPred[i] === 1 ? v : null), pointRadius: 4, showLine: false }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#cfe0ff' } } },
                    scales: {
                        x: { ticks: { color: '#a8b0d8' } },
                        y: { ticks: { color: '#a8b0d8' } }
                    }
                }
            });

            probaChart = new Chart(ctx2, {
                type: 'line',
                data: { labels: dates, datasets: [{ label: 'P(Up)', data: yProba, tension: .2 }] },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#cfe0ff' } } },
                    scales: {
                        x: { ticks: { color: '#a8b0d8' } },
                        y: { min: 0, max: 1, ticks: { color: '#a8b0d8' } }
                    }
                }
            });
        }

        function setMetrics(m) {
            $('m-acc').textContent = fmt(m.accuracy, 3);
            $('m-prec').textContent = fmt(m.precision, 3);
            $('m-rec').textContent = fmt(m.recall, 3);
            $('m-f1').textContent = fmt(m.f1, 3);
        }

        function setStatus(msg, type = 'info') {
            const node = document.createElement('div');
            node.className = 'pill';
            node.innerHTML = type === 'loading' ? `<span class="spinner"></span> ${msg}` : msg;
            $('status').innerHTML = '';
            $('status').appendChild(node);
        }

        // ---------- API Wiring ----------
        async function fetchPredictions(payload) {
            try {
                const r = await fetch('/api/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (r.ok) { return await r.json(); }
                throw new Error('Backend not available');
            } catch (e) {
                console.warn('Using mock data:', e.message);
                return mockResponse(payload);
            }
        }

        // Mock response generator (deterministic-ish)
        function mockResponse({ ticker, start, end }) {
            const days = 250;
            const dates = [...Array(days)].map((_, i) => {
                const d = new Date(start); d.setDate(d.getDate() + i); return d.toISOString().slice(0, 10);
            });
            let price = 100, close = [];
            for (let i = 0; i < days; i++) {
                price *= (1 + (Math.sin(i / 17) / 300) + (Math.random() - 0.5) / 200);
                close.push(Number(price.toFixed(2)));
            }
            const yProba = close.map((_, i) => 0.5 + 0.45 * Math.sin(i / 23));
            const yPred = yProba.map(p => p > 0.5 ? 1 : 0);
            const metrics = { accuracy: 0.61, precision: 0.60, recall: 0.58, f1: 0.59 };
            return { ticker, start, end, dates, close, y_pred: yPred, y_proba: yProba, metrics };
        }

        // ---------- Handlers ----------
        $('predictForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const payload = {
                ticker: $('ticker').value.trim() || 'IBM',
                index: $('index').value.trim() || null,
                start: $('start').value,
                end: $('end').value,
                features: {
                    stock_volatility: $('feat-vol').checked,
                    stock_momentum: $('feat-mom').checked,
                    index_volatility: $('feat-idxvol').checked,
                    index_momentum: $('feat-idxmom').checked,
                    rsi14: $('feat-rsi').checked,
                },
                label: 'next_day_up',
                kernel: 'rbf'
            };

            setStatus('Running prediction…', 'loading');
            const res = await fetchPredictions(payload);
            setStatus('Done');
            $('dateRange').textContent = `${res.dates?.[0] || payload.start} → ${res.dates?.slice(-1)[0] || payload.end}`;
            drawCharts(res.dates, res.close, res.y_pred, res.y_proba);
            setMetrics(res.metrics || {});
        });

        $('resetBtn').addEventListener('click', () => {
            $('ticker').value = 'IBM';
            $('index').value = '';
            setDefaultDates();
            $('feat-vol').checked = true;
            $('feat-mom').checked = true;
            $('feat-idxvol').checked = false;
            $('feat-idxmom').checked = false;
            $('feat-rsi').checked = true;
            $('status').innerHTML = '';
            setMetrics({});
            $('dateRange').textContent = '';
            if (priceChart) priceChart.destroy();
            if (probaChart) probaChart.destroy();
        });
    </script>
</body>
</html></div></fieldset>